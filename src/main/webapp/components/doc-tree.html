<link rel="import" href="/ResourceServingWebapp/webjars/polymer__polymer/3.0.2/bower_components/polymer/polymer.html">
<!--<link rel="import" href="/ResourceServingWebapp/webjars/polymer/polymer.html">-->
<!--<link rel="import" href="/CMSContent/js/polymer.html">-->
<link rel="import" href="/CMSContent/components/doc-selector.html">
<link rel="import" href="/CMSContent/components/doc-tree-node.html">
<!--<link rel="import" href="/ResourceServingWebapp/webjars/iron-ajax/iron-ajax.html">-->

<dom-module id="doc-tree">
	<template>
		<div>
			<div class="form-group">
				<label for="doc_title">Title:</label>
				<input type="text" class="form-control" id="doc_title" name="doc_title">
			</div>
			<div class="form-group">
				<doc-selector id="selector" onChange="update_source(this);" ></doc-selector>
			</div>
			<input type="search" id="doc_tree_search" class="form-control" value="[[sources]]" placeholder="Search..."></input>
			<div id="doc_tree" style="height: 250px;overflow: hidden;overflow-y: scroll;">
<!--				<iron-ajax-->
<!--				auto-->
<!--				url="/CMSContent/v2/document/list"-->
<!--				params='{"source":"Internal"}'-->
<!--				handle-as="json"-->
<!--				on-response="_handleDocumentList">-->
			</div>
			<div class="form-group" style="display: none;">
				<label for="doc_loc">Selected Path:</label>
				<input id="doc_loc" type="text" class="form-control" name="doc_loc" disabled="disabled">
			</div>
			<div class="form-group">
				<label for="doc_id">Document Name/ID:</label>
				<input id="doc_id" type="text" class="form-control" name="doc_id">
			</div>
			<div class="form-group">
				<label for="doc_search">Search Terms:</label>
				<input id="doc_search" type="text" class="form-control" name="doc_search">
			</div>
			<p>
				<div class="btn-group" role="group" aria-label="Editor actions">
					<button id="load_btn" onclick="load();return false" class="btn btn-default" title="Load Selected Document">Load</button>
					<button id="save_btn" onclick="save();return false" class="btn btn-success" title="save document" disabled="disabled">Save</button>
					<button id="delete_btn" onclick="delete_doc();return false" class="btn btn-danger" title="delete document">Delete</button>
					<button id="new_btn" onclick="newFolder();return false" class="btn btn-info" title="New Folder">New Folder</button>
					<a id="return_btn" href="/uPortal/p/cmseditor" class="btn btn-primary">Return</a>
					<a id="att_btn" href="/uPortal/p/attman" class="btn btn-default" title="Go to attachments manager"><i class="fa fa-paperclip"></i></a>
				</div>
			</p>
		</div>
	</template>
	<link rel="import" href="/js/polymer.html">
	<script>
		Polymer({
			is: 'doc-tree',
			properties: {
				sources: {
					type: String,
				},
			},
			ready: function () {
				console.log("Preparing Doc Tree");
			},
			_handleDocumentList: function(event){
				console.log("Handling document list");
				console.log(event);
				console.log(event.detail.response);
			},
		});
		function update_source(selector)
		{
			console.log(selector.__data__['source']);
			var request = new XMLHttpRequest();
			request.open('GET','/CMSContent/v2/document/list?source='+selector.__data__['source'],true);
			request.onload = function()
			{
				console.log(request.responseText);
				for(var i in JSON.parse(request.responseText))
				{
					console.log(i["title"]);
					
				}
			}
			request.send();
		};
	</script>
</dom-module>
